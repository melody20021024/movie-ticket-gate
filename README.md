# 電影票券系統 (Movie Ticket Gate)

這是一個基於 Flask + SQLite 的電影票券管理系統，提供完整的電影票券購買、驗證和管理功能。

## 專案結構

### 核心檔案

#### `app.py` (25KB, 642行)
**主要應用程式檔案**
- Flask 主應用程式
- 包含所有路由和業務邏輯
- 功能包括：
  - 電影展示和票券購買
  - QR碼生成和驗證
  - 管理員後台（登入、場次管理、驗票）
  - 票券查詢和轉讓
  - Email 通知功能

#### `tickets.db` (36KB)
**SQLite 資料庫檔案**
- 儲存所有系統資料
- 包含以下資料表：
  - `movies`: 電影資訊（標題、描述、海報、時長、允許廳次）
  - `showtimes`: 場次資訊（電影ID、開始時間、廳次、座位數）
  - `tickets`: 票券資訊（票券ID、姓名、電影、座位、Email、驗證狀態）

### 初始化和管理腳本

#### `init_movies.py` (1.6KB, 50行)
**電影資料初始化腳本**
- 定義預設電影資料（沙丘2、哥吉拉大戰金剛、Barbie）
- 將電影資料插入資料庫
- 設定每部電影的允許放映廳次（1,2,3廳）

#### `db_migration_v2.py` (3.3KB, 96行)
**資料庫結構遷移腳本**
- 建立和更新資料庫結構
- 添加必要的欄位（email、verified、allowed_screens等）
- 確保資料庫結構與應用程式需求一致

#### `auto_schedule.py` (2.2KB, 57行)
**自動排程腳本**
- 根據電影時長和允許廳次自動生成場次
- 從早上9點開始排程
- 考慮電影間隔時間和廳次清潔時間
- 生成每日的電影放映時間表

### 前端模板 (templates/)

#### `index.html` (3.2KB, 74行)
**首頁模板**
- 顯示所有電影列表
- 每部電影顯示海報、標題、描述
- 提供購買票券的連結

#### `movie_detail.html` (2.6KB, 58行)
**電影詳情頁面**
- 顯示單部電影的詳細資訊
- 列出該電影的所有場次
- 顯示每個場次的剩餘座位數

#### `buy_form.html` (6.3KB, 135行)
**購票表單頁面**
- 選擇場次和座位
- 填寫購票人資訊（姓名、Email）
- 支援多張票券購買
- 視覺化座位選擇介面

#### `preview_ticket.html` (3.0KB, 70行)
**票券預覽頁面**
- 顯示購買的票券資訊
- 包含QR碼圖片
- 提供下載和Email發送選項

#### `my_tickets.html` (8.5KB, 209行)
**我的票券頁面**
- 查詢票券（依姓名或Email）
- 顯示票券詳細資訊
- 支援票券轉讓功能
- 顯示驗證狀態

#### `result_success.html` (917B, 28行)
**驗票成功頁面**
- 顯示驗票成功的訊息
- 包含票券詳細資訊

#### `result_fail.html` (459B, 19行)
**驗票失敗頁面**
- 顯示驗票失敗的訊息
- 提供錯誤說明

### 管理員後台模板

#### `admin_login.html` (3.2KB, 115行)
**管理員登入頁面**
- 管理員身份驗證
- 登入表單和安全驗證

#### `admin_dashboard.html` (7.1KB, 216行)
**管理員儀表板**
- 顯示所有票券列表
- 票券統計資訊（總數、已驗證、未驗證）
- 手動驗票功能
- 票券搜尋和篩選

#### `admin_showtimes.html` (2.3KB, 62行)
**場次管理頁面**
- 顯示所有場次列表
- 新增、編輯、刪除場次功能
- 顯示每個場次的剩餘座位數

#### `admin_add_showtime.html` (1.9KB, 47行)
**新增場次頁面**
- 新增場次的表單
- 選擇電影、時間、廳次、座位數

#### `admin_edit_showtime.html` (2.1KB, 46行)
**編輯場次頁面**
- 修改現有場次的表單
- 預填現有資料

### 靜態資源 (static/)

#### 電影海報
- `Dune.jpg` (64KB) - 沙丘2海報
- `Godzilla.jpg` (11KB) - 哥吉拉大戰金剛海報
- `Barbie.jpg` (13KB) - Barbie海報

#### QR碼圖片
- 大量 `.png` 檔案 - 系統自動生成的票券QR碼
- 每個檔案對應一張票券的QR碼

### 設定和說明文件

#### `EMAIL_SETUP.md` (3.1KB, 133行)
**Email設定說明文件**
- 詳細說明如何設定SMTP服務
- Gmail應用程式密碼設定步驟
- Email模板和格式說明

#### `venv/` 目錄
**Python虛擬環境**
- 包含所有必要的Python套件
- 確保專案依賴的隔離性

## 主要功能

1. **電影展示**: 首頁顯示所有可購買的電影
2. **票券購買**: 選擇場次和座位，完成購票
3. **QR碼驗證**: 生成QR碼並支援驗票功能
4. **票券查詢**: 依姓名或Email查詢票券
5. **票券轉讓**: 支援票券轉讓給其他使用者
6. **管理員後台**: 完整的場次管理和驗票功能
7. **Email通知**: 購票後自動發送Email確認
8. **自動排程**: 根據電影時長自動生成場次

## 技術架構

- **後端**: Flask (Python)
- **資料庫**: SQLite
- **前端**: HTML + CSS + JavaScript
- **QR碼**: qrcode 套件
- **Email**: smtplib
- **圖像處理**: OpenCV (cv2)

## 啟動方式

1. 啟動虛擬環境：`venv\Scripts\activate`
2. 執行應用程式：`python app.py`
3. 開啟瀏覽器：`http://127.0.0.1:5000`

## 管理員登入

- 網址：`http://127.0.0.1:5000/admin/login`
- 密碼：`admin123`

